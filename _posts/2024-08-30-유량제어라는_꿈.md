---
date: 2024-08-30
layout: post
title: 유량제어라는 꿈
categories: [Backend]
image: >-
    https://github.com/user-attachments/assets/8153482d-7743-4eb7-8b46-66d4e001b48a
---

## 좋은 꿈이었다...

![t6zfmb6sabx51](https://github.com/user-attachments/assets/78855300-2ee7-4d9e-924e-346dc076d4d4)

네이버에서 답장이 와서, 이전 글에 이어서 내용을 써본다.

결론부터 말하자면 유량제어고 나발이고 서비스 폐업 위기다.
약관 위반이라 기존 서비스 로직으로는 운영이 어려울 것 같다.
어느정도 우회하는 방법이 있긴 한데, 그러면 유저 경험이 급격히 안좋아져서 며칠동안 계속 고민중이다. 이걸 계속 해야되나 말아야되나 나도 잘 모르겠다.

## 약관 브레이커

> 안녕하세요. 네이버 클라우드 플랫폼입니다.
> 
> 1) 비정상적 트래픽 발생에 대해서는 아래와 같이 수정을 부탁드립니다.
> 
> - as-is: 1,000 pixel 이미지 초당 약 70회 요청 
> 
> - to-be: 1,000 pixel 이미지 초당 10회 이하 
> 
> 
> 2) 맵 호출 결과 저장에 대해서는 시정되지 않은 경우 서비스 제공 중단이 될 수 있는 점 안내 부탁드립니다. 
> 
>       자세한 내용은 아래 참고 부탁드립니다.
> 
> 
> * 고객의 서비스 ‘Map Shot’은 네이버 클라우드 플랫폼의 Static Map API로 지도 이미지를 여러 차례 호출한 뒤 1개의 이미지로 머지 해주는 방식으로 운영되고 있습니다. 'Map Shot'의 사용자는 지정한 옵션에 따라 생성된 지도 이미지를 jpg 형식으로 다운로드하여 여러 차례 사용이 가능한 것으로 보입니다. 이와 같은 서비스 과정에서 Maps API의 결과 데이터가 저장되고 있으며, 이는 네이버 클라우드 플랫폼의 Maps API 서비스 이용 약관에서 금지하는 이용 방식입니다. 
> 
> 
> 
> * 약관 본문 (https://www.ncloud.com/policy/terms/opapi)
> 
>       ㄴ네이버 클라우드 플랫폼 AI NAVER API 서비스 이용 약관 - 부가 조항 - 개별 API 별 특약 조건 - Maps API 서비스
> 
>       ㄴ(2) ‘고객’은 Maps API의 결과 데이터를 (해당 결과 데이터를 받은 즉시 자신의 서비스에서 사용하는 것이 아니라) 별도로 저장해서는 안 되며, 따라서 그와 같은 결과 데이터를 별도로 저장하는 방식으로 데이터베이스화하여 이용해서도 안됩니다. 예를 들면, Maps API의 결과 데이터로 전송받는 지도 타일(Tile) 데이터를 모아서 (그 이후에는 API를 호출하지 않고) 재사용하는 것은 엄격히 금지됩니다. 즉, 모든 Maps API의 결과 데이터는 값을 리턴 받는 즉시 1회 자신의 서비스에서 사용하는 것만 허용되며, 그렇지 않고 그 결과 값들을 별도로 저장, DB화, 재사용하는 것은 금지됩니다.
> 
> 더 궁금한 사항이 있으시면 고객지원으로 문의 부탁드립니다.
> 
> 네이버 클라우드 플랫폼 드림.

내용의 필요한 부분만 요약해보면

- 초당 호출 10회 이하로 줄일 것
- 지도 이미지 일체의 재가공을 하지 말 것

이 두가지다. 나한테 가장 치명적인건 2번째다. 
시정되지 않으면 서비스 중단이라니까 지키긴 지켜야겠는데, 막막하긴 하다.

서비스 런칭 전에 약관을 안찾아본건 아니다. DB에 저장 금지, 매번 API로 새 지도 호출 이런 내용이어서 재가공은 해당사항이 없는 줄 알았다. 어쨌든 코드로 쉽게 말하면 새 canvas 컨텍스트에 이미지가 들어가는 순간 재가공으로 간주되는 것 같다.  더 골아픈건 지도 약관들 뒤늦게나마 꼼꼼히 뒤져보니 다 비슷한 맥락의 약관이 존재하는 것 같아서, 다른 서버에서 가공해서 가져오는 카카오랑 구글도 다 바꿔야 할 것 같다.

## 대책

사실 어느정도 대안이 있긴 하다.

나는 지도 템플릿만 생성해주고, 그 이후의 작업은 유저에게 맡기는 일종의 약관 회피다.
나랑 비슷한 기능을 제공해주는 서비스가 존재하는데, 그곳도 이미 이런식으로 운영되고 있다. 

근데 계속 드는 생각이 유저 경험이 기존에 비해 너무 나빠지는 방식이기도 하고, 그렇게 운영할거면 그냥 그 서비스 쓰면 되지않나 싶어서 잘 모르겠다. 그만 운영할때가 온건가 싶기도 하고...

어느 정도 더 생각 정리가 되면 다음글에 결론을 작성해보려 한다.

## 참고

- 내 경험