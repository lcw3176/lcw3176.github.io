---
date: 2024-06-14
layout: post
title: 변경에 대한 온도차 줄이기
categories: [Language]
image: >-
    https://github.com/lcw3176/lcw3176.github.io/assets/59993347/cbfedb56-e923-4337-9a3e-aad1398dd3c5
---

## 일교차

여름이 다가오고 있는 것 같다. 아직은 시기상 초여름으로 분류되지만 꽤나 더운 날씨들이 계속되고 있다.

초여름과 한여름의 차이가 뭘까 한번 생각해봤는데, 일교차가 적다는 것이 특징이 아닐까 싶다.
전자의 날씨는 아침, 저녁에는 비교적 선선한 반면에 여름이 절정에 달하면 뜨거운 날씨가 거의 하루종일 지속된다.

멍멍이도 안걸린다는 여름 감기에 걸리는 시기가 주로 일교차가 큰 초여름이라고 한다.
이런 경험에 기반한 본능인걸까, 우리는 변화무쌍한 것보단 안정적인 것을 선호하는 경향이 있을 것이다.

소프트웨어, 코드도 결국 현실의 물체나 현상을 옮겨온다고 생각하기 때문에 이런 습성이 반영되는 듯 하다.
우리는 다른 클래스의 변화에 민감하지 않고 서로 의존적이지 않은 아키텍쳐를 좋은 구조라고 말한다.

오늘은 운영중인 서비스의 패키지 구조를 어떤 식으로 개선해 나갔는지, 그동안 해왔던 생각들을 정리해보고자 한다.
물론 정답은 없다. 그래도 오답은 피하려고 노력해봤다.

## 1. 기능

### controller, service, repository...

처음엔 기능별로 클래스들을 분류했다.

```sh
└── src
    └── controller
        └── NoticeController
        └── MapController
        └── ...
    └── service
        └── NoticeService
        └── MapService
        └── ...
    └── repository
        └── NoticeRepository
        └── ...
```

진짜 서비스 초창기에는 컨트롤러 2개 있고, api 서버에서 하는 일이 거의 없다시피 해서 관리에 큰 어려움이 없었다.

그런데 점점 기능에 살이 붙어가고, 서버쪽 코드가 커지면서 뭔가 정신 산만한 구조가 되어가고 있었다.
가장 큰 문제는 기능별로 구별하고자 했던 이 패키지 구조가 
점점 의도와는 다르게 작동하는 곳들이 발생했다.

### common, global 이라는 짬통

뭔가 애매한 클래스들이 점점 발생하기 시작했다.
주로 특정 작업만 단편적으로 수행하는 유틸성 클래스가 해당이 많이 된 것 같은데,
이런 애들은 어디로 분류할지에 대한 고민이 시작되었다. 
그리고 가장 만만한 네이밍을 찾았으니, 대망의 common, global이다.

분류에 대한 고민이 드는 순간 빠져나올 수 없는 잡동사니 모음집 패키지에 클래스를 생성했고,
점점 세력이 커져가는 것을 보면서 이제는 더 나은 방법에 대한 고민을 할 시점이라 생각했다. 


## 2. 속성

### map, notice, auth...

이 코드가 속한 속성에 따라 패키지를 구별해보자는 생각을 했다.

```sh
└── src
    └── notice
        └── NoticeController
        └── NoticeService
        └── ...
    └── admin
        └── AdminController
        └── AdminService
        └── ...
    └── auth
        └── AuthFilter
        └── EncrpytUtil
        └── ...
```

예를 들면 공지사항 관련 코드들을 같은 패키지에 모으고, 보안이나 권한 관련은 auth 패키지에 다 모아놓는 방식이다.

지금 다시 생각해보면 이 구조 자체가 문제라기보다는 내가 속성들에 대한 분류를 제대로 못한게 가장 큰 패인이 아닌가 싶다. 패키지를 분류하는 속성에 대한 기준이 제대로 없었다.

### 거미줄은 체계라도 있지

이 때 당시 가장 큰 문제점은 변경사항에 대한 영향이 너무나도 컸다는 것이다.

사실 이때가 어드민 관련 기능들이 생기던 시점인데, 뭐만 바꾸면 어드민쪽에도 변경사항이 생겼다. 가장 큰 원인은 서비스 클래스에서 이곳저곳 속성들의 서비스나 레포지토리를 중구난방으로 참조하고 있었다.

예를 들자면 어드민 기능중에 공지사항을 등록, 수정하는 기능이 있다고 해보자.
이런 기능을 전부 공지사항쪽에 구현해놓으니 어드민 서비스에서 필연적으로 공지사항 서비스를 참조해야 한다. 이를 해결하기 위해 어드민 쪽에서 공지사항 엔티티를 참조, 별도의 레포지토리를 만들고 어드민에 관련된 쿼리들을 작성했으나 결국엔 공지사항에 대한 참조는 없어지지 않은 셈이고, 오히려 속성별로 모아보겠다는 처음의 취지도 무색해지고 있었다.

더 나은 방법이 없을까 계속 고민을 했다.

## 3. 적절히 섞어보자





## 참고

- 내 경험