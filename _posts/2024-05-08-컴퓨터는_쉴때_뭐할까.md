---
date: 2024-05-08
layout: post
title: 컴퓨터는 쉴때 뭐할까?
categories: [OS]
image: >-
    https://github.com/lcw3176/lcw3176.github.io/assets/59993347/d42f94e7-0a97-42e4-95a1-9bf7ec23ee04
---

## 컴퓨터는 쉬는시간에 뭐할까

```c
// https://github.com/torvalds/linux/blob/dccb07f2914cdab2ac3a5b6c98406f765acab803/kernel/sched/idle.c

static void do_idle(void)
{

    while (!need_resched()) {
		// ...
        cpuidle_idle_call();
        // ...
    }
}

```


```c
// https://github.com/torvalds/linux/blob/master/arch/x86/kernel/process.c#L742
void __cpuidle default_idle(void)
{
	raw_safe_halt();
	raw_local_irq_disable();
}

```

```c
// https://github.com/torvalds/linux/blob/dccb07f2914cdab2ac3a5b6c98406f765acab803/include/linux/irqflags.h#L186

// ...
#define raw_safe_halt()			arch_safe_halt()
// ...
```

```c

// https://github.com/torvalds/linux/blob/dccb07f2914cdab2ac3a5b6c98406f765acab803/arch/x86/include/asm/irqflags.h#L45


static __always_inline void arch_safe_halt(void)
{
	native_safe_halt();
}

// ...

static __always_inline void native_safe_halt(void)
{
	mds_idle_clear_cpu_buffers();
	asm volatile("sti; hlt": : :"memory");
}

```


## 참고

- https://yohda.tistory.com/entry/%EB%A6%AC%EB%88%85%EC%8A%A4-%EC%BB%A4%EB%84%90-Cpuidle-function
- https://github.com/torvalds/linux
- https://modoocode.com/en/inst/sti