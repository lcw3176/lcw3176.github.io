---
date: 2024-02-05
layout: post
title: 개인 서비스 운영비 줄이기
categories: [Devops]
image: >-
    https://github.com/lcw3176/lcw3176.github.io/assets/59993347/97813d32-9c64-4510-befe-3b9fd9950ea0
---


3줄 요약

1. 쪼매난 서비스면 aws 람다만 잘써도 서버비 많이 절약할 것 같다
2. aws쪽 사용할거면 aws 강연 듣고 설문조사해도 서버비 땜빵 가능하다
3. 그 외 무료 서비스들도 찾아보면 생각보단 쓸만하다

### 람다

이미지 관련 서비스 운영중인데, 저번달에 비해서 aws 람다의 스펙을 사실상 4배가량 올려놔서 돈 걱정되서 한번 접속해보았다.

타임아웃 에러가 생각보다 많이 와서 로그를 봤는데, 로직으로 개선하는건 더 이상 힘들다고 생각해서 서버 스펙을 올려야겠다고 생각했다.

일단 돈이 얼마 나오는지 보자.

![스크린샷 2024-01-18 오전 12.26.21.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/a5e0a105-cb05-45a7-9e89-d891fd37f979)

뭐 별로 안나오긴 하는데 고정지출로 자꾸 나가면 신경쓰이긴 한다. 하필 안쓰는 계좌이기도 해서.

과금이 어디서 많이 나가는지 한번 까보면,

![스크린샷 2024-01-18 오전 12.47.19.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/25435e78-64a9-4887-8a28-c8e801cb9993)

사실상 ec2 기본 작동시간에 대한 요금이 주를 이루고 있다.

한 가지 눈여겨볼 성과가 람다 스펙을 제법 올렸는데도 과금이 거의 안나오고 있다. 이전 스펙이 너무 귀여웠던 탓일까.

![스크린샷 2024-01-18 오전 12.42.46.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/3052b9f6-cb17-4c90-b4b5-3e02638cb29d)


기존 1기가에서 현재 4기가로 올려놨다. 얘는 묵직한 작업 전용이기도 이미지 생성 방식에 따라서 요청이 올 때도 있고 안올때도 있고 해서 하루에 많아야 50건 내외다.


![스크린샷 2024-01-18 오전 12.42.21.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/6f15a2fb-3f23-4b9d-a96e-4fa2f73334a1)


메모리 사용량만 보면 1기가 유지해도 될 것 같지만, 람다가 메모리 용량에 따라서 부가적인 스펙이 전부 결정되기 때문에(네트워크, cpu 사양 등등) 1기가 쓰면 생각보다 작업을 잘 못빼낸다.

사실 cors 에러만 안나면 클라이언트 쪽에서 전부 처리하고 싶긴하다.


![스크린샷 2024-01-18 오전 12.28.46.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/13b4ebfd-fde7-4e8a-ad59-4755322fc109)


얘는 가벼운 작업 처리하는 용도다. 하루에 많으면 2000건 정도 처리하는데 사양이 깜찍해서 그런가 람다쪽에서는 어쨌든 과금이 거의 진행되고 있지 않다.

![스크린샷 2024-01-18 오전 12.29.45.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/dca164c2-ed44-4b7c-aec0-b8a3c08ae7e3)


작업을 우수수 빼던 내역이다.

### 크레딧 좀비


![스크린샷 2024-01-18 오전 12.26.32.png](https://github.com/lcw3176/lcw3176.github.io/assets/59993347/03789912-5715-47be-a168-4681246593b5)

aws 강연 듣고 설문조사 하고 메일 링크 넣으면 크레딧을 준다.

돈 없을때 좋은 방법 중 하나다. 공부도 하고 서버비 벌고.

생각보다 크레딧 결제 범위가 넓어서 개인이 서비스하는 범위는 대부분 결제가 될 것 같다.

### 그 외 무료

오라클 무료 서버 생각보다 쓸만하다.
aws 프리티어 가입하면 생성할 수 있는 t2 마이크로보다 약간 더 성능이 좋았던 기억이 난다.
arm으로 된거 인스턴스 생성하면 램 32기가짜리도 무료로 만들 수 있고 그랬는데 지금은 어떤지 모르겠다. 근데 자꾸 지들 맘대로 서버 정지시키거나 회수해가고 깽판 이슈가 좀 있기는 하다.

헤로쿠도 초기 로딩 시간 긴 것만 빼면 쓸만했는데 무료 회원이 없어져서 좀 그렇긴 하다. 대신 국내 서비스중에 클라우드타입이라고 있다. 헤로쿠랑 거의 똑같다.

네이버 클라우드도 가입하면 크레딧 줬던 기억이 있다. 그런데 생각보다 과금 요소가 많아서 금방 쓴다. 네이버 클라우드는 기억나는게 aws 람다 비슷한 서비스가 하나 있다. 클라우드 펑션인가 그랬을거다. 근데 얘만 사용하면 로그 남기는데 좀 문제가 있다. 난 이미지 서비스라 바디값으로 이미지 바이트값은 로깅에서 해제하고 싶은데 그게 통짜로 다 남게 되어있어서 서버 비용이 아니라 로깅 비용으로 폭격 한번 맞은적 있다. 근데 국내 ip 필요한 서비스면 강제로 써야된다. 난 지도이미지가 해외반출되는게 법으로 막혀있어서 잠시 네이버쪽 서버를 써야했다.

nhn에서도 뭔가 호스팅이 가능했던거 같은데 ui가 익숙하지를 않아서 가입만 하고 나온 기억이 있다.

프론트만 필요하면 무료 호스팅 많다. Cloudflare Pages 나 netlify, 깃허브 호스팅 등등 선택지가 다양했다. 근데 여기에 커스텀 도메인 붙이겠다고 Freenom에서 무료 도메인 구입하라는 글이 많은데 내가 그거 따라했다가 제대로 피봤다. 하지 않는것을 추천한다. 그냥 돈 주고 사자.
Freenom쪽 도메인이 가끔 국내 통신사에서 접속을 막아버린다. 그냥 며칠 기도하고 있다 보면 다시 접속되긴 하는데 만약 대처할거면 유저한테 DNS 주소 직접 os에서 바꿔달라고 해야된다. 말이 안된다. 그냥 기도하자.

만약 도메인 별도 구매 안할거면 netlify가 조금 더 기본 도메인 제공해주는 생김새가 낫긴 하다. 키워드 변경도 살짝 되고. 클라우드플레어는 거의 난독화 한 수준으로 만들어줘서 사실상 못외운다.

쓰다보니 뭐가 많은데, 로깅은 sentry도 무료 사용량이 생각보다 괜찮고 국내 서비스중에 와탭이라고 있다. url 감시나 서버 인스턴스 감시 정도는 무료로 가능해서 괜찮다. 개인 서비스면 저렴이 서버 쓸 가능성이 농후하기 때문에 네이버 핀포인트나 lg 그거 뭐지 스카우터인가 그런건 꿈도 꾸지 말자. 서버 올리는 순간 메모리 부족으로 모든 프로세스가 줘터지는걸 볼 수 있다. 별로 좋은 경험은 아닐거다.

도메인은 그냥 사자. Freenom은 말도 하기 싫고 정 별개의 무료 도메인이 필요하면 [내도메인.한국](http://내도메인.한국) 여기서 발급은 가능하다. 첫 갱신이 3개월인가 그렇고 그 다음부터는 1년단위로 갱신 가능했던 것 같다.

서버 인증서는 돈주고 사라고 해도 어려운 분야긴 한데 추천하는 방식은 그냥 도메인 구입하는데서 주는거 붙이는게 제일 속 편하다. 정말 싫으면 클라우드플레어 들어가면 야매로 https 만들어주는 서비스가 있기는 하다. 무료고 설정도 편하다. 서버에서 크론탭 돌리면서 서트봇이었나 그걸로 직접 갱신코드 작성하는건 정신이 피폐해질 가능성이 크다. 한 5분만 검색해보면서 진행해보면 클라우드플레어 가는 자신을 볼 수 있을거다. 레퍼런스가 맞는게 잘 없다. 대부분은 내 서버와 맞지 않는 레거시 정보일 확률이 크다. 그리고 이거 몇회 이상 틀리면 그날은 작업 못하게 막아버리고 그런기능도 있어서 피 거꾸로 솟는다.

## 참고

- 내 경험