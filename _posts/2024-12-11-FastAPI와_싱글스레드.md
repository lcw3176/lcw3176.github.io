---
date: 2024-12-11
layout: post
title: FastAPI와 싱글스레드
categories: [Backend, AI]
image: >-
    https://github.com/user-attachments/assets/1ce1d60b-b21c-4fcf-8b4e-346a9b11cfa7
---

## 그냥 문득

코드치다가 갑자기 궁금해서 await와 스레드간의 관계에 대해 고민을 해봤다. 
그런데 생각의 흐름이 막히는 부분들이 있어서 중간중간 찾아본김에 정리해보려 한다.

## 파이썬과 GIL

파이썬은 일단 별도의 설정 없이는 싱글 스레드 기반이다.

혹시 레디스처럼 뒷단에서는 뭔가 멀티스레드로 처리하는건 아닌가 싶어서 찾아봤는데
GIL 메커니즘 때문에 기본적으로 한 번에 하나의 스레드만 실행된다고 한다.
결국 여러 스레드를 생성해도 어느 특정 한 시점의 스냅샷을 찍으면 언제나 한 개의 스레드만 실행된다는 것이다.

그런데 여기서부터 뭔가 의문 투성이었다. 
많은 사람들이 성능 향상을 위해 async 같은 비동기 키워드를 사용한다고 들었는데, 이게 어떤 의미를 가지는지 감이 오지를 않았다. 

이 작업이 완료되는동안 스레드가 블로킹되지 않는다는 것에 의의를 두는 것은 알겠는데, 
그러면 그 시간동안 다른 작업을 처리하는데 더 집중할 수 있다는 건가? 해당 작업은 일단 await 하는채로?? 
그런데 싱글 스레드 기반인데 다른 작업에 시간을 더 할애한다는 게 어떻게 가능한거지???
뭔가 컨텍스트 스위치 대상에서 얘를 빼버리는걸까???? 근데 얘는 프로세스가 아니라 스레드인데?????

이런 의문들이 들어서 실실 검색을 해봤다.

## 참고
