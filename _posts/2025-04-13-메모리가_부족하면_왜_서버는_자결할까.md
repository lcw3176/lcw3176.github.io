---
date: 2025-04-13
layout: post
title: 메모리가 부족하면 왜 서버는 자결할까
categories: [Backend]
image: https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Prim%C3%A4res_System.png/1200px-Prim%C3%A4res_System.png
---

저번 주제에 이어서 글을 쓰려 했는데, 일단 발표가 조금 밀린 관계상 나중에 쓰기로 했다. 
남은 주제가

- 문제 2. 찾을 수 없는 로그와 히스토리
- 문제 3. 테스트? 그게 뭔데?
- 문제 4. 지금 내가 짜는게 곧 표준
- 문제 5. 제약 없는 배포 프로세스
- 문제 6. 작성한 코드의 대략적인 영향력 생각하기

이정도 되는 것 같은데, 이번주에 장애가 나서 관련 분석 내용을 좀 써볼까 한다.
회사 시스템 + 고객사 리소스 라는 환장의 조합이라 어디까지 적을 수 있는지는 모르겠는데, 
뭐 두루뭉술하게 적으면 대부분 적어도 상관없으리라 생각한다.

그리고 대부분의 리소스에 나는 접근 권한조차 없어서, 많은 내용이 글로 대체될 예정이다.
로그 분석도 너무 힘들었다. 로그를 보는게 힘든게 아니라, 안그래도 빈약한 로그에 접근조차 할 수 없어서...

## 배포, 리소스 폭주

프론트엔드 팀원분이 api 서버쪽 코드 수정본을 배포하고 사고가 났다. 
기술 집약적인 회사에 다니는 분들이 이 글을 읽으면 첫 문장부터 이게 뭔소린가 할텐데, 그냥 중소기업의 현실이라고 봐주면 될 것 같다.

내가 기억하는 언뜻 보았던 모니터링 지표들과 스쳐 지나가며 확인한 로그를 되짚어 보면, 
새로 배포한 컨테이너 자체가 리트라이 카운트가 찍히며 뜨지 못하고 있었고 cpu와 메모리 사용량이 수직 상승했다.

나도 뭘 돕고 싶은데 권한도 없고 고객사 리소스라 할 수 있는 액션 자체가 극히 제한되서 약간 넋놓고 지켜만 보는 시간이 계속되었는데 어느 순간 지 혼자 살아났다.
뭐가 문제였을까 궁금해서 주말동안 이리저리 코드도 살펴보고, 기억에 의존한 디버깅을 시작했다.


