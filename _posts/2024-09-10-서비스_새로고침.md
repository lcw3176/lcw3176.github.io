---
date: 2024-09-10
layout: post
title: 서비스 새로고침
categories: [Backend]
image: >-
    https://github.com/user-attachments/assets/ee341376-3116-413e-9d15-fba7451b0d17
---

## 서비스 새로고침

저번 글 작성 이후로 정말 많이 고민했는데, 일단은 계속 운영하기로 했다.

그렇게 생각하게 된 이유와, 몇 가지 걱정되는 점들, 새로 개선된 점이나 개발하면서 어려웠던 점들을 기록해 놓으려고 한다.

## 왜 계속하는가

### 아직은 쓸만한 경험이다

비록 기존 유저 경험에 비해 한 스텝이 늘어났지만, 아직은 경쟁력이 있다고 생각한다.
예전의 내 서비스와 비교한다면 퇴보가 맞다.
하지만 나랑 비슷한 기능을 제공하는 서비스들과 비교한다면, 이보 전진 후 일보 후퇴라고 생각한다. 
아직은 한 발 앞서있다고 생각한다.

이 쪽 도메인이 보통 큰지도 만들기, 큰지도 제작 이런식으로 불리는데 검색하면 대표적으로 나오는 서비스가 한 곳 있다.
오래전부터 서비스해왔고, 가장 널리 알려져있기 때문에 비교대상으로 삼을 수 밖에 없는데 
내 서비스가 유저 경험면에서 조금은 더 나은 부분들이 있지 않을까 생각한다. (범위 미리보기, 렌더링 방식, 국토교통부 도시계획 덧입히기 등등...)


### 기능 호환성, 호출량이 최적화되었다

![스크린샷 2024-09-10 153412](https://github.com/user-attachments/assets/79e91f1e-ebc5-44d4-91f4-114cbeff6bba)

국토교통부 관련 api에서 불러오는 도시 계획 레이어 기능이 존재한다.
현재 해당 토지가 어떤 구역으로 묶여있는지, 도로 정보는 어떻게 되어 있는지 등등의 정보를 불러오는 기능이다. 이 레이어 api가 좌표 기반으로 호출하는데, 기존에는 좌표값 계산 및 보정을 내가 만든 커스텀 라이브러리를 통해서 진행했기 때문에, 특정 지도 타입에서만(네이버 지도) 사용할 수 있었다.

그런데 이번에 지도 생성 방식, 좌표 보정 방식을 대폭 변경했기 때문에 모든 지도 타입에 도시 계획 레이어가 적용 가능해졌다. 게다가 지도 생성 방식 변경으로 인해 지도 이미지 호출량도 크게 개선되었다.


![image](https://github.com/user-attachments/assets/3ec003fe-1b84-4ac8-8379-0e567a421075)


![스크린샷 2024-09-10 154033](https://github.com/user-attachments/assets/53fee97f-ab5c-4709-9455-8ff9158de762)

위에서부터 네이버 지도 호출량, 국토교통부 api 호출량이다.

글 작성일 기준 어제(24.09.09) 방문자가 200명 좀 안되게 잡히는데, 200명 치고는 조금 과한 호출량이긴 하다. 자세한 개발 얘기는 아래에 더 적을것이지만, 네이버 지도와 국토교통부 지도가 조그만 타일들을 하나씩 호출해서 수백개를 이어붙여주는 방식으로 작동했기 때문에 호출량이 유독 많았다. 
그 덕에 네이버한테 메일도 받아봤으니 소원성취 다 했다.

딴 얘기긴 한데 당근에서 맵샷 관련 얘기가 나온적이 있었다. 그때 나왔던 말이 '약관에 아슬아슬하게 걸쳐있는 것 같다. 네이버나 카카오한테 내용증명 메일 날라오면 성공한 서비스 아니겠냐' 라는 내용을 농담식으로 웃으며 말씀하셨는데, 그래서 그런가 네이버 쪽에는 죄송한 말이긴 한데 솔직히 메일 받고 기분 좋았다.


### 아직 출금 못했다

![스크린샷 2024-09-10 155123](https://github.com/user-attachments/assets/45a10838-454e-485b-baa4-970988d1c07d)

이건 개인 소망인데, 카카오 애드핏에서 구글 애드센스로 지면 광고를 몇 달 전에 변경했다. 

구글 광고를 한 50번 거절 당했다가 뉴스 요약 게시판이 생긴 덕분인지 겨우 승인이 났다. 최근에 핀번호 메일도 받아서 차곡차곡 광고비 쌓아가고 있었는데, 출금 못하고 서비스 종료하면 뭔가 슬플 것 같다.


## 무엇이 우려되는가

### 사실상 야매 아닌가?

![스크린샷 2024-09-10 162602](https://github.com/user-attachments/assets/b7caec86-cc7a-4d60-b2d1-13667e89a759)

사실상 약관 회피, 우회가 아닌가 싶고 혹시나 또 다른 위반사항은 없는지가 가장 걱정되는 부분이다.

이 방식이 제재 먹으면 더 이상 다른 방법은 없는거라서, 진짜 샷다 내려야된다. 그래서 최근에 새로운 서비스를 런칭하려고 준비도 했었다. 
개잡부라고, '개발자의 job을 부탁해' 뭐 이런 네이밍이었는데, 개발자 채용 정보 관련 서비스였다. 
그런데 데이터 좀 긁어모으자 마자 바로 채용사이트에서 아이피 영구밴 당해서 강제로 접었다. 이 정도로 엄격하면 운영중에도 분명 문제가 생길 소지가 다분했기 때문에...

신규 서비스에 대해 아이디어는 몇 개 있는데 항상 가공하려는 데이터가 문제가 된다.
 언젠가는 나만의 데이터를 가공하는 서비스를 런칭하고 싶은데, 뭐라도 시도하다보면 되는 날이 있겠지???? 

### 유저들은 과연 받아들일까?

이건 몇 주 정도 추이를 지켜봐야 알 것 같은데, 유저 이탈률이 얼마나 될 지 모르겠다.
어쨌든 과거의 내 서비스와 비교하면 편의성 부분에서 어느정도 물러난게 있어서, 유저들이 잘 적응하고 사용할 지 미지수다. 

나도 어떻게든 서비스를 지속하려고 노력한다는 점만 알아주면 좋겠다. 광고비로 서버비 충당은 개뿔 내 돈 생짜로 나가고 있는데 ㅠㅠㅠ

면접에 가면 종종 물어보시는게 내 돈까지 써가며 왜 굳이 서비스를 유지하는지 물어보시는데, 다양한 이유가 있다. 내 목표 중 하나가 정말 많은 사람들이 사용하는 서비스를 런칭해 보는것이기도 하고, 예전에 작성한 [3년의 서비스 운영기](https://lcw3176.github.io/posts/3%EB%85%84%EC%9D%98_%EC%84%9C%EB%B9%84%EC%8A%A4_%EC%9A%B4%EC%98%81%EA%B8%B0/)  에 썼던 것처럼 내 기술적 자아 실현장으로 쓰려는 것도 있지만, 요즘 더 드는 생각은 같은 분야의 사람들이 모이는 서비스를 운영한다는 것도 언젠간 도움이 되지 않을까 싶다. 

## 개선, 개발 썰

### 좌표 보정

![img](https://github.com/user-attachments/assets/8632d0ae-8702-4d12-925d-f3b5cf3df28d)


이번에 지구는 둥글다는 것을 뼈저리게 느꼈다.

관련 게시글들이 잘 없어서, 이건 내가 따로 정리해서 포스팅을 한번 하려고 한다. 
여기서 가볍게 써보자면, 지구는 동글동글 하기 때문에 평면에서 계산하듯이 좌표를 계산하면 오차가 발생한다. 
적도로 갈수록 넓어지고, 극지방으로 갈수록 좁아지는 구조이기 때문에 평면에서 계산하듯 좌표 사이 간격을 계산하면 오차가 누적된다.

![250355857-54d34f27-bfe8-4bc3-91a4-c051c2128c7d](https://github.com/user-attachments/assets/56bc7534-010b-4d73-95b5-d75cf95e9855)

기존 내 방식에서 문제가 되었던 부분이 뭐냐면, 네이버 지도와 국토교통부쪽 레이어는 지도 중심 좌표와 경계 좌표를 이용해 적절한 크기로 분할한 후, 
각 타일별로 이미지를 호출해서 나중에 합치는 방식으로 운영하고 있었다.
이걸 기존에는 내가 만든 커스텀 좌표 보정 라이브러리를 이융해서 타일별 중점 좌표를 계산했는데, 맞는 값을 찾는 게 진짜 힘들었다.
기존에는 서울에서의 좌표 이동값, 전라남도에서의 좌표 이동값을 구하고 둘의 차이값으로 보정을 하는 방식이었는데, 
문제는 각 점에서의 좌표 이동값을 내가 하루종일 경도 조금씩 옮겨가면서 눈으로 확인하는 방식이었다.
서울에서 0.0001만큼 이동시켜보고, 사진 한번 보고, 0.0002만큼 이동시켜보고, 사진 이어지나 확인하고 이런식으로 두 점의 좌표 이동값을 구했는데
다시 그 짓을 할 엄두가 안나서 도시계획 레이어를 접어야 하나 고민했다.

고민하며 지도 api 문서들을 살펴보던 찰나, 현재 지도의 경계값 좌표를 가져오는 코드를 발견했다.
그래서 결정한 방식은 경계값의 좌표를 이용해서 도시계획 이미지 한장을 불러온 후, 확대해서 덧입히는 방식으로 진행했다.
이미지가 약간씩 깨지고 세부적인 도면 정보가 표시되지 않는 단점이 있긴 한데, 이 정도로 일단 타협하기로 했다.

저 작업도 지도 서비스마다 사용하는 좌표계가 다른건지, EPSG:4326 기반으로 똑같이 좌표값을 넘겨도 위도에 따라 이미지가 계속 틀어졌다.
혹시나 싶어서 지도별 좌표계 정보를 찾아봤고, 카카오는 EPSG:5181, 구글은 EPSG:3857, 네이버는 자체 보정 좌표계를 기반으로 사용한다는 정보를 찾았다.
그래서 EPSG:4326 좌표를 각 회사에 맞게 변경 후, 그 정보로 도시계획 레이어를 요청하니 다행히 이미지가 딱 맞아떨어졌다. 

### 인프라 축소, 보안 관리

현재 서버 인프라가 aws 람다 3개, ec2 1개 그리고 오라클 클라우드 서버 2대가 구동중이다.
aws쪽 리소스가 대부분 운영에 사용되고, 오라클 쪽은 모니터링, 테스트 서버 환경이 구축되어 있다.
이제는 서버측에서 할 일이 공지사항, 게시글 DB 보내는것 말고는 딱히 없어서, 인프라를 많이 정리할 생각이다.

람다쪽은 하나 빼고는 전부 정리가 가능할 것 같고, 지금 고민중인게 ec2를 없애고 테스트 서버로 쓰던 오라클쪽에 운영 서버를 놓을까 생각중이다.
오라클이 말도없이 서버 껐다켰다 해서 좀 불안하긴 한데, 게시판이랑 공지사항은 사용률이 저조해서 그렇게 해도 뭐 큰 문제는 없다.

또 하나 찝찝한게 구글 지도가 한 번 호출될때마다 과금 카운팅이 되는데, 
기존에는 서버에서 호출 제어를 해서 크게 걱정 안했는데 지금은 퍼블릭으로 풀려있는 상황이라 어떻게 할 지 고민중이다.
클라우드플레어 디도스 플랜 같은걸 쓰면 거의 확실하게 막힐 것 같긴한데, 
매번 접속할때마다 사람입니다 체크체크 하는것도 사용성이 좀 그렇지 않나 싶어서 일단 고민중이다.
일단은 구글쪽에 하루에 일정 횟수 이상 호출을 못하게 사용량 제한을 걸어두긴 했다. 일단은 이렇게 가보자.  

### 로고 만들기

![로고](https://avatars.githubusercontent.com/u/59993347?v=4)

개발 얘기는 아니긴 한데 서비스 로고를 새로 만들었다.

기존 로고는 맵샷 의뢰했던 친구가 일러스트로 만들어줬는데, 그냥 심심해서 내가 한번 새로 만들어봤다.
조금 더 서비스 의도에 부합하는 로고를 만들어 보려고 뚝딱뚝딱 해봤는데, 잘 표현이 됐는지 모르겄다.


## 앞으로는?

일단 지금 계획중인건 문의란을 조금 더 고도화 할까 어렴풋이 생각중이다.

지금은 외부 서비스를 통해서 내 메일로 오게 하고 있는데, 
사진첨부 같은것도 넣고 내쪽 관리자 페이지에서 처리가 가능하도록 바꿔볼까 고민중이다. 
게시판 형식으로 바꿔볼까 싶기도 하고...

현재 답신 받을 메일을 직접 입력하도록 폼이 구성되어 있는데 메일을 실수로 잘못 타이핑하시는지
내 답신 메일이 전송 실패하거나, 계속 확인을 안하시는 분들도 있어서 어떻게 바꿔야 효율적일지 일단 계속 구상중이다.

부디 이 작업을 할때까지 맵샷이 살아있기를 바라며...

## 참고

- 내 경험, 생각